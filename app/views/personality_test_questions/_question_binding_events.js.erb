$wrapper = $(' <%= escape_javascript render( partial: 'edit') %>');
$('#pt_question_info_wrapper').html($wrapper);
$wrapper.find('.x-editable').editable();
//TODO: Отставить только один из инициализатоов
$('.x-editable-question').editable({
    validate: function(value) {
        if($.trim(value) == '') {
            return 'Пустая строка недопустима';
        }
    }
});
$('.editable-image').click( function() {
    $(this).next('input:file').click();
});
$('.editable-image-input').change(function(event) {
    var $this = $(this);
    var id = $this.data('id');
    var questionId = $this.data('questionId');
    var type = 'patch';
    var $img = $this.prev();

    if (!id) {
        id = '';
        type = 'post';
    }

    if ($this.prop('files')) {
        var file = $this.prop('files')[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function (event) {

                $.ajax({url: "/personality_test_question_pictures/" + id,
                    type: type,
                    data: {question_id: questionId, filename: file.name, data: event.target.result},
                    success: function (data, status, xhr) {
                        $img.attr('src', event.target.result);
                    }
                });
            };
            reader.readAsDataURL(file);
        }
    }
});
